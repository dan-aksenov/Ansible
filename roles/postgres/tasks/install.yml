# file: roles/install-postgresql-on-el6/tasks/install.yml -- install postgresql packages

- name: "Stage 1: install repository package"
  yum: 
    state: present
    name: https://yum.postgresql.org/{{ postgresql_version }}/redhat/rhel-7-x86_64/pgdg-{{ ansible_distribution | lower }}{{ postgresql_version | replace('.','') }}-{{ postgresql_version }}-1.noarch.rpm

#  yum repo key section
#- name: "Stage 1: install rpm key"
#  rpm_key:
#    state: present
#    key: http://apt.sw.be/RPM-GPG-KEY.dag.txt
	
- name: "Stage 1: install postgresql packages"
  yum: 
    state: latest
    pkg: "{{ item }}"
  with_items:
    - postgresql{{ postgresql_version | replace('.', '') }}-server

- name: "Stage 1: install postgresql contrib package"
  yum: 
    state: latest
    pkg: postgresql{{ postgresql_version | replace('.', '') }}-contrib
  when: postgresql_contrib
